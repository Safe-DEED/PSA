![Safe-DEED Logo](https://github.com/Safe-DEED/PSA/blob/master/Safe-DEED_logo.png)

# PSA-lib

This javascript library was developed for building arbitrary PSA applications.

### Compatibility

The library supports both CommonJS and ES Modules.

### Installation instructions

To install the library one just needs to execute

`$ npm install psa-lib`

in the project root.
Import the library with

`var PSA = require('psa-lib');`

or

`import PSA from 'psa-lib';`

for CommonJS or ES Modules syntax, respectively.

### Usage

When retrieving the context with either getClientContext or getServerContext, one must provide the polymodulus degree
and the plaintext modulus.

The polymodulus degree can be one of:

- 4096
- 8192
- 16384

The plaintext modulus can be set arbitrarily. However, applications in the past, using the library, were using 20 bit.

For users who don't know how to choose the parameters, I recommend using 4096 as the polymodulus degree and 20 as the
plaintext modulus. If the noise budget gets consumed, try using the next higher polymodulus degree.

**Note:** The application may run out of memory with a polymodulus degree of 8192 or 16384. A solution is to specify a
different compression mode such as 'none' or the slower 'zlib' over the default 'zstd'. In addition, you may need to
increase the JavaScript heap size by adding `--max-old-space-size=4096` for NodeJS.

### API docs

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

##### Table of Contents

- [getClientContext](#getclientcontext)
  - [Parameters](#parameters)
- [getServerContext](#getservercontext)
  - [Parameters](#parameters-1)
- [encrypt](#encrypt)
  - [Parameters](#parameters-2)
- [encryptForClientRequest](#encryptforclientrequest)
  - [Parameters](#parameters-3)
- [decrypt](#decrypt)
  - [Parameters](#parameters-4)
- [decryptServerResponseObject](#decryptserverresponseobject)
  - [Parameters](#parameters-5)
- [getSerializedGaloisKeys](#getserializedgaloiskeys)
  - [Parameters](#parameters-6)
- [compute](#compute)
  - [Parameters](#parameters-7)
- [computeWithClientRequestObject](#computewithclientrequestobject)
  - [Parameters](#parameters-8)

#### getClientContext

[src/index.mjs:12-24](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L12-L24 'Source code on GitHub')

This asynchronous function return the client context object.

##### Parameters

Accepts an Object with the following keys:

- `polyModulusDegree` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the polymodulus degree
- `plainModulus` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the plaintext modulus
- `securityLevel` **[number<128|192|256>](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the security level to use. Defaults to 128 bits.
- `compressionMode` **[string<'none'|'zlib'|'zstd'>](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/string)** the compressino mode to use. Defaults to 'zstd'

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** a context object necessary for client side actions

#### getServerContext

[src/index.mjs:34-46](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L34-L46'Source code on GitHub')

This asynchronous function return the server context object.

##### Parameters

Accepts an Object with the following keys:

- `polyModulusDegree` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the polymodulus degree
- `plainModulus` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the plaintext modulus
- `securityLevel` **[number<128|192|256>](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** the security level to use. Defaults to 128 bits.
- `compressionMode` **[string<'none'|'zlib'|'zstd'>](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/string)** the compressino mode to use. Defaults to 'zstd'

Returns **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** a context object necessary for client side actions

#### encrypt

[src/index.mjs:79-105](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L79-L105 'Source code on GitHub')

This function encrypts the client's input vector and returns an array of ciphertexts.

##### Parameters

- `inputArray` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** 1D array of numbers
- `clientContext` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** client side context

Returns **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;CipherText>** an array of ciphertexts

#### encryptForClientRequest

[src/index.mjs:113-126](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L113-L126 'Source code on GitHub')

This function encrypts the client's input vector and returns an object ready to be sent to the server.

##### Parameters

- `inputArray` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** 1D array of numbers
- `clientContext` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** client side context

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON to be sent to server without further processing

#### decrypt

[src/index.mjs:134-152](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L134-L152 'Source code on GitHub')

This function decrypts the computed result vector. The result will be in the first n cells, if the matrix was of dimension (m x n).

##### Parameters

- `encryptedResult` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;CipherText>** 1D array of ciphertexts received from server computation
- `clientContext` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** client side context

Returns **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** resulting array

#### decryptServerResponseObject

[src/index.mjs:160-163](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L160-L163 'Source code on GitHub')

This function decrypts the server response object. The result will be in the first n cells, if the matrix was of dimension (m x n).

##### Parameters

- `serverResponseObject` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** server response object (JSON), received from the server
- `clientContext` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** client side context

Returns **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** resulting array

#### getSerializedGaloisKeys

[src/index.mjs:207-209](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L207-L209 'Source code on GitHub')

This function returns the serialized galois key needed for rotations of the ciphertext.

##### Parameters

- `clientContext` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** client side context

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** base64 encoded galois key

#### compute

[src/index.mjs:174-200](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L174-L200 'Source code on GitHub')

This function computes the dot product between the encrypted client vector and the server matrix.
Constraints: If vector is of dimensions (1 x m), then matrix has to be of (m x n).

##### Parameters

- `encryptedArray` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;CipherText>** 1D array of ciphertexts received from client
- `serializedGaloisKeys` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** base64 encoded galois key
- `matrix` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** a 2D array of Numbers.
- `serverContext` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** server side context

Returns **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;CipherText>** an array of ciphertexts

#### computeWithClientRequestObject

[src/index.mjs:219-236](https://github.com/Safe-DEED/PSA/blob/master/src/index.mjs#L219-L236 'Source code on GitHub')

This function computes the dot product between the encrypted client vector and the server matrix.
Constraints: If vector is of dimensions (1 x m), then matrix has to be of (m x n).

##### Parameters

- `clientRequestObject` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** client request object (JSON), received from client
- `matrix` **[array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** a 2D array of Numbers.
- `serverContext` **[Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** server side context

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** JSON to be sent to client for decryption

## Acknowledgements

This project has received funding from the European Union’s Horizon 2020 research and innovation programme under grant agreement No 825225.
